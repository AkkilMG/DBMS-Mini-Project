CREATE DATABASE POLICE_CONNECT;
USE POLICE_CONNECT;


-- Tables

CREATE TABLE UserRole (
    RoleID INTEGER,
    RoleName VARCHAR(30),
    Description VARCHAR(150),
    Permissions VARCHAR(20),
    PRIMARY KEY(RoleID)
);

CREATE TABLE USER (
	UserID VARCHAR(20) NOT NULL,
    Username VARCHAR(15),
    Password VARCHAR(75),
    Email VARCHAR(40),
    PhoneNumber VARCHAR(12) NOT NULL,
    WANumber VARCHAR(12),
    AccStatus INTEGER DEFAULT 0,
    RoleID Integer DEFAULT 0,
    PRIMARY KEY(UserID),
	FOREIGN KEY (RoleID) REFERENCES UserRole(RoleID)
);

CREATE TABLE CASE_REPORTING (
    CaseID VARCHAR(20) NOT NULL,
    ReportDate DATE,
    CrimeType VARCHAR(40) NOT NULL,
    IncidentDate DATE,
    IncidentLoc VARCHAR(20)  NOT NULL,
    UserID VARCHAR(20),
    EvidenceDoc VARCHAR(50) NOT NULL,
    EvidenceDesc VARCHAR(200) NOT NULL,
    SuspeciousDocs VARCHAR(50),
    SuspeciousDesc VARCHAR(200),
    Anonymity BOOLEAN NOT NULL,
    PRIMARY KEY(CaseID),
    FOREIGN KEY (UserID) REFERENCES USER(UserID)
);

CREATE TABLE PENDING_CASES (
    CaseID VARCHAR(20) NOT NULL,
    PRIMARY KEY(CaseID),
    FOREIGN KEY (ReportID) REFERENCES CASE_REPORTING(ReportID)
);

CREATE TABLE EVIDENCE (
	UserID VARCHAR(20),
    EvidenceID VARCHAR(20) NOT NULL,
    CaseID VARCHAR(20),
    CaseDesc VARCHAR(400),
    EvidenceDesc VARCHAR(400) NOT NULL,
    EvidenceDocs VARCHAR(75),
    EvidenceLoc VARCHAR(50),
    Submitted DATE,
	Anonymity BOOLEAN NOT NULL,
    PRIMARY KEY(EvidenceID),
	FOREIGN KEY (CaseID) REFERENCES CASE_TRACKING(CaseID),
	FOREIGN KEY (UserID) REFERENCES USER(UserID)
);


-- Roles

INSERT INTO UserRole (RoleID, RoleName, Description, Permissions) 
VALUES (1, 'User', 'Regular user role', 'read');

INSERT INTO UserRole (RoleID, RoleName, Description, Permissions) 
VALUES (2, 'Police Personal', 'Role for police personnel', 'read, write');

INSERT INTO UserRole (RoleID, RoleName, Description, Permissions) 
VALUES (3, 'Administrator', 'Role for administrators', 'read, write, manage');



-- TRIGGER
DELIMITER //

CREATE TRIGGER PENDING_LIST
AFTER INSERT ON CASE_REPORTING FOR EACH ROW
BEGIN
    INSERT INTO PENDING_CASES (CaseID) VALUES (NEW.CaseID);
END //

DELIMITER ;

